<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Tutorial: Communication Between Cluster IPs</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Tutorial: Communication Between Cluster IPs</h1>

    <section>

<header>
    

    <h2>Communication Between Cluster IPs</h2>
</header>

<article>
    <p>How we are going to make a request to the event bus using the name of our cluster IP</p>
<p><img src="../../doc_assets/screenshots/Docker/request-to-event-bus.png" alt="request-to-event-bus"></p>
<p>The next thing we want to do, is update our Posts service to point to our event bus, rather than localhost</p>
<p>and update our event bus service to point to our posts cluster IP. rather than localhost.</p>
<blockquote>
<p>posts/index.js</p>
</blockquote>
<pre class="prettyprint source lang-js"><code> // Send post request to /events
  await axios.post(&quot;http://event-bus-srv:4005/events&quot;, {
    type: &quot;PostCreated&quot;,
    data: { id, ...post },
  });

</code></pre>
<blockquote>
<p>event-bus/index.js</p>
</blockquote>
<pre class="prettyprint source lang-js"><code>
app.post('/events', (req, res) => {
  const event = req.body; 

  events.push(event);

  axios.post('http://posts-clusterip-srv:4000/events', event).catch(err => console.log(err));
</code></pre>
<p>now we just need to update both our posts and event-bus deployments by rebuilding the images and pushing it to docker hub and restart our deployments</p>
<pre class="prettyprint source lang-bash"><code>
docker build -t codenameninja/event-bus .
docker push codenameninja/event-bus
kubectl rollout restart deployment event-bus-depl

docker build -t codenameninja/posts .
docker push codenameninja/posts . 
kubectl rollout restart deployment posts-depl

</code></pre>
<h3>Verifying Communication</h3>
<p>Open our postman client and then make a post request to our NodePort Port which for me is on <code>30290</code></p>
<p>if you don't know, use <code>kubectl get services</code> and find the NodePort Service.</p>
<p>then make a post request to <code>http://localhost:30290/posts</code></p>
<p><img src="../../doc_assets/screenshots/Docker/posts-request-to-nodeport.png" alt="posts-request-to-nodeport"></p>
<p>let's verify that we recieved the request in our Posts Pod, by viewing the logs with Kubectl.</p>
<pre class="prettyprint source lang-bash"><code>
> kubectl get pods
NAME                              READY   STATUS    RESTARTS   AGE
event-bus-depl-6764959bdb-nmb6j   1/1     Running   0          7m25s
posts-depl-6c6f8d97cb-m9hzw       1/1     Running   0          7m17s

> k logs posts-depl-6c6f8d97cb-m9hzw

> posts@1.0.0 start
> nodemon index.js

[nodemon] 2.0.15
[nodemon] to restart at any time, enter `rs`
[nodemon] watching path(s): *.*
[nodemon] watching extensions: js,mjs,json
[nodemon] starting `node index.js`
v.0.2.5
Listening on 4000
Event Recieved PostCreated

</code></pre>
<p>Great, we now can make a request to our Posts Service and see that we recieved the event.</p>
</article>

</section>

</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-routers__id_comments.html">routers/:id/comments</a></li><li><a href="module-routers_posts.html">routers/posts</a></li><li><a href="module-routers_query.html">routers/query</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-routers__id_comments-CommentApiRequest.html">CommentApiRequest</a></li><li><a href="module-routers_posts-PostApiRequests.html">PostApiRequests</a></li><li><a href="module-routers_query-QueryApiRequest.html">QueryApiRequest</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-index-docker.html">Docker</a></li><li><a href="tutorial-index-kubernetes.html">Kubernetes</a></li><li><a href="tutorial-index_.html">A Mini Microservice App</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Sun Feb 20 2022 18:54:06 GMT+0200 (South Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>